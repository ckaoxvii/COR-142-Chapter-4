---
title: "Chapter 4: Regression--Exploring Association Between Variables"
subtitle: "COR 142 C"
author: "Dr. Kao"
format: 
  html:
    toc: true
    toc-location: right
    embed-resources: true
    css: styles.css
    lightbox: true
---

```{r}
#| include: false

library(dplyr)

library(ggplot2)

library(janitor)

library(palmerpenguins)

library(crosstalk)

library(shiny)

library(bslib)

library(DT)

library(scales)
```

## Section 4.1. Visualizing Variability With a Scatterplot

::: {.callout-note appearance="default" icon="false"}
## Scatterplot

-   The primary tool for examining relationship between two [**numerical**]{style="color:red"} variables.
-   Each point in a scatterplot represents [**a single observation**]{style="color:red"}.
:::

:::: {.callout-tip appearance="default" icon="false"}
## Example 4.1.1.

::: panel-tabset
## Question

What does the scatterplot below tell you about the relationship between number of floors in a building and their heights?

![](figures/ch_4_fig_1.png){width="80%" fig-align="center"}

## Answer

[In general, the height of a building tends to increase as the number of its floor increases.]{style="color:red"}
:::
::::

::: {.callout-note appearance="default" icon="false"}
## Examining Scatterplots

There are three features of a scatterplot we will focus on.

-   [**Trend:**: Finding the "center" of the scatterplot from left to right]{style="color:red"}
-   [**Strength:** How "spread out" the points are in the plot]{style="color:red"}
-   [**Shape:** Linear or nonlinear]{style="color:red"}
:::

::: {.callout-note appearance="default" icon="false"}
## Shape

-   **Linear:** Scatterplots that cluster around a [**line**]{style="color:red"} model linear trends.
-   **Nonlinear:** Not all data trends are linear, we model the nonlinear data using a [**curve**]{style="color:red"} rather than a line.
:::

::: {.callout-note appearance="default" icon="false"}
## Trend

-   The [**general tendency**]{style="color:red"} of the scatterplot as you read [**from left to right**]{style="color:red"}.
-   The typical trends are:
    a.  Increasing, this is called a [**positive**]{style="color:red"} association.
    b.  Decreasing, this is called a [**negative**]{style="color:red"} association.
    c.  [**No trend**]{style="color:red"}, if there is neither a positive nor a negative tendency.
:::

::: {.callout-note appearance="default" icon="false"}
## Strength of an Association

-   Scatterplots with [**small**]{style="color:red"} amount of scatter, or little [**vertical**]{style="color:red"} variation indicate a [**strong**]{style="color:red"} association.
-   Scatterpltos with [**large**]{style="color:red"} amount of scatter, or [**large vertical**]{style="color:red"} variation indicate a [**weak**]{style="color:red"} association.
:::

::: {.callout-note appearance="default" icon="false"}
## Writing Descriptions of Associations

When writing a description of an association between two numerical variables, *always* include the following:

1.  [**trend (positive, negative, or no trned)**]{style="color:red"}
2.  [**strength (strong or weak)**]{style="color:red"}
3.  [**shape (linear or nonlinear)**]{style="color:red"}
4.  Mention any observations that do that fit the general trend (if any).
:::

::: {.callout-note appearance="default" icon="false"}
## Be Careful Describing Association

-   Always use a phrase such as [**tends to**]{style="color:red"} when describing an association because any trend in description has variability. The association you are describing may not be true for all individual data.
-   *Always* point out any data points that appear to be [**unusual**]{style="color:red"} or not part of the general pattern.
:::

## Section 4.2. Measuring Strength of Association with Correlation

::: {.callout-note appearance="default" icon="false"}
## Correlation Coefficient

-   A number that measures the strength of a [**linear**]{style="color:red"} relationship.
-   We use the letter [$r$]{style="color:red"} to denote the correlation coefficient.
-   $r$ *always* takes value between $-1$ and $+1$, i.e., [$-1 \leqslant r \leqslant 1$]{style="color:red"}.
-   $r$-value close to $-1$ or $+1$ indicate a [**strong**]{style="color:red"} linear association.
-   $r$-value close to 0 indicate a [**weak**]{style="color:red"} linear association.
:::

```{r}
#| echo: false

set.seed(20250922)

sec_42_fig <- function(m, sd, plot_title) {
  data.frame(x = 1:20, y = m*1:20 + rnorm(20, mean = 0, sd = sd)) |> 
    ggplot(aes(x, y)) +
    geom_point() +
    theme_bw() + 
    labs(title = plot_title) +
    theme(
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.y = element_blank(),
      panel.grid.minor.y = element_blank(),
      axis.title.x = element_blank(),
      axis.text.x = element_blank(),
      axis.ticks.x = element_blank(),
      axis.title.y = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks.y = element_blank()
    )
}
```

```{r}
#| layout-ncol: 2
#| echo: false
 
sec_42_fig(1/3, 0, "Perfect Positive Correlation")

sec_42_fig(1/3, 0.3, "Strong Positive Correlation") 

sec_42_fig(1/3, 1, "Weak Positive Correlation") 

sec_42_fig(1/3, 5, "No Correlation") 

sec_42_fig(-1/3, 1.2, "Weak Negative Correlation")  

sec_42_fig(-1/3, 0.33, "Strong Negative Correlation")  

sec_42_fig(-1/3, 0, "Perfect Negative Correlation")  
```

:::: {.callout-tip appearance="default" icon="false"}
## Example 4.2.1.

::: panel-tabset
## Question

Consider the following scatterplots with the correlation coefficients for each plot given. What can you say about the relationship between the $r$-value and the vertical variation in the data?

![](figures/sec_42_fig_1.png)

## Answer

As $r$ [**increases**]{style='color:red'}, there is [**less**]{style='color:red'} vertical variation in the data, i.e., the trend is stronger.
:::
::::

::: callout-important
## Important Notes about the Correlation Coefficient

1.  Changing the [**order**]{style="color:red"} of the variable does not change $r$.
2.  Adding a constant or multiplying by a positive constant does not affect $r$.
3.  $r$ is [**unitless**]{style="color:red"}.
4.  $r$ is only useful to measure a [**linear**]{style="color:red"} trend. *Always* graph your data first before computing $r$ to make sure the association is linear.
:::

## Sections 4.1, 4.2 Examples

:::: {.callout-tip appearance="default" icon="false"}
## Example 1.

::: panel-tabset
## Question

Below is a scatterplot showing the weights of 36 cars versus their horsepower. What can you say about the trend in the plot? Describe the relationship between the weight of the cars and their horsepower.

```{r}
#| echo: false
# p1 <- mtcars |> 
#   ggplot(aes(wt, hp)) +
#   geom_point() +
#   theme_bw() +
#   labs(x = 'Weight (ton)', y = 'Horsepower') 
  
# p1 |> 
#   ggplotly() |>
#   config(displayModeBar = FALSE)
```

![](/figures/ch_4_fig_2.png){width="80%" fig-aling="center"}

## Answer

The scatterplot shows a [**positive**]{style="color:red"} trend because the graph increases from left to right. This means as the weight of the car [**increases**]{style="color:red"}, the horsepower tends to [**increase**]{style="color:red"} also.
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 2.

::: panel-tabset
## Question

Below is a scatterplot of the weight of 36 cars vs their mileage (mpg). What can you say about the trend in the plot? Describe the relationship between the weight of the cars and their mileage.

![](/figures/ch_4_fig_3.png){width="80%" fig-align="center"}

## Answer

The scatterplot shows a [**negative**]{style="color:red"} trend because the graph decreases from left to right. This means that as the weight of the car [**increases**]{style="color:red"}, the mileage tends to [**decrease**]{style="color:red"}.
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 3.

::: panel-tabset
## Question

Below is a scatterplot of heart rate (bpm) vs. body temperature (F). What can you say about the trend in the plot? Describe the relationship between heart rate and body temperature.

![](/figures/ch_4_fig_4.png){width="80%" fig-align="center"}

## Answer

The scatterplot shows [**no trend**]{style="color:red"} because the points seem to follow no predictable pattern. This means that there is no relationship between [**heart rate**]{style="color:red"} and [**body temperature**]{style="color:red"}.
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 4.

::: panel-tabset
## Question

Consider the scatterplot shown below. This data set shows an association between the $x$- and $y$-variables, but it cannot be characterized as positive or negative. It is certainly ______.

```{r}
#| echo: false
#| message: false

df_41_42_ex_4 <- tibble(
  x = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 
1.3, 1.4, 1.6, 1.5, 1.7, 1.8, 1.9, 2, 2.1, 2.2, 2.3, 2.4, 2.5, 
2.6, 2.7, 2.8, 2.9, 3, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 
3.9, 4, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9),
  y = c(58.7, 45, 52, 32.2, 32.5, 33.9, 12.6, 19.8, 18.6, 14.6, 15.1, 
12, 7.7, 15.4, -0.7, 9.5, 3.4, 3.3, 1.8, 4, 2.8, 1.1, 5.7, 4.2, 
2, -3.2, 2.1, 1.2, -4.5, 6.6, 11.1, 22.5, 24.8, 25.4, 18.3, 17.5, 
26, 40.4, 38.9, 44.1, 42.5, 43.4, 59.2, 59.7, 61.7, 73.2, 83.4, 
89, 96.4, 96.3)
)

plt_41_42_ex_4 <- df_41_42_ex_4 |> 
  ggplot(aes(x, y)) +
  geom_point() +
  geom_smooth(
    method = 'lm',
    formula = y ~ x + I(x^2),
    color = 'red',
    linewidth = 1.25,
    se = FALSE
  ) +
  theme_bw() + 
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  )

plt_41_42_ex_4
```

## Answer

Consider the scatterplot shown below. This data set shows an association between the $x$- and $y$-variables, but it cannot be characterized as positive or negative. It is certainly [**nonlinear**]{style='color:red'}.

:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 5.

::: panel-tabset
## Question

Consider the two scatterplots below. One shows height (in) versus weight (lb), and the other shows waist size (in) versus weight (lb). Compare the strength of the associations in these two plots.

![](/figures/ch_4_fig_6.png){fig-align="center"}

## Answer

There is a stronger association between [**waist size**]{style="color:red"} and [**weight**]{style="color:red"} (less vertical variation in the graph) than between [**height**]{style="color:red"} and [**weight**]{style="color:red"}.
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 6.

::: panel-tabset
## Question

The scatterplot below shows snout vent length (in) vs weight of alligators. What kind of relationship can you conclude from the plot?

```{r}
#| echo: false
#| message: false

df_42_ex_5 <- tibble(
  snout = c(3.4, 3.5, 3.5, 3.6, 3.6, 3.7, 3.7, 3.8, 3.8, 3.8, 3.8, 3.8, 
3.9, 4.2),
  weight = c(3.3, 3.5, 3.6, 3.6, 3.9, 4.4, 4.4, 4.5, 4.4, 4.2, 4.4, 4.7, 
4.9, 5.9)
)

plt_42_ex_5 <- df_42_ex_5 |> 
  ggplot(aes(snout, weight)) +
  geom_point() +
  theme_bw() + 
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) +
  labs(
    x = 'Snout Vent Length (in) on Log Scale',
    y = 'Weight (lb) on Log Scale'
  )

plt_42_ex_5
```
## Answer

The relationship between the snout length and weight of alligators is a [**strong, positive, and linear**]{style="color:red"} one.
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 7.

::: panel-tabset
## Question

The table below shows the number of miles driven on a recent trip for 8 rented cars and the amount of gas (in gallons) used for each trip.

a.  Use the built-in app to compute and interpret the correlation coefficient, $r$.
b.  What can you say about the relationship between miles driven and fuel consumption?

|                      |      |      |     |      |       |      |      |      |
|----------------------|------|------|-----|------|-------|------|------|------|
| **Miles Driven**     | 200  | 150  | 110 | 60   | 350   | 225  | 400  | 300  |
| **Fuel Consumption** | 11.1 | 5.37 | 4.4 | 1.71 | 11.67 | 7.76 | 12.5 | 9.09 |

## Answer

a.  According to the app, the calculated $r$-value is [**0.9055**]{style="color:red"}.
b.  Since $r$ is [**close to** $+1$]{style="color:red"}, there is a [**strong, positive**]{style="color:red"} linear association between miles traveled and fuel consumption.

The relationship between the snout length and weight of alligators is a [**strong, positive, and linear**]{style="color:red"} one.
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 8.

::: panel-tabset
## Question

Match each scatterplot to its closest $r$-value in the table below.

|         |         |          |         |
|---------|---------|----------|---------|
| $0.885$ | $0.724$ | $-0.341$ | $0.119$ |

```{r}
#| echo: false

df_ex_8_1 <- data.frame(
  x = c(0.043, 0.063, 0.100, 0.141, 0.196, 0.201, 0.208, 0.211, 0.221, 0.229,
        0.235, 0.244, 0.252, 0.258, 0.260, 0.263, 0.272, 0.281, 0.284, 0.294,
        0.297, 0.302, 0.309, 0.316, 0.321, 0.324, 0.330, 0.334, 0.344, 0.355,
        0.359, 0.359, 0.361, 0.366, 0.371, 0.376, 0.379, 0.380, 0.382, 0.386,
        0.387, 0.392, 0.393, 0.397, 0.400, 0.404, 0.410, 0.419, 0.426, 0.432,
        0.439, 0.445, 0.447, 0.466, 0.474, 0.481, 0.509, 0.520, 0.533, 0.544,
        0.563, 0.570, 0.587, 0.594, 0.637),
  y = c(0.322, 0.196, 0.568, 0.278, 0.196, 0.364, 0.547, 0.439, 0.321, 0.404,
        0.466, 0.414, 0.572, 0.292, 0.356, 0.245, 0.476, 0.573, 0.335, 0.439,
        0.221, 0.511, 0.269, 0.318, 0.422, 0.359, 0.426, 0.502, 0.268, 0.389,
        0.327, 0.184, 0.475, 0.584, 0.302, 0.462, 0.359, 0.384, 0.286, 0.431,
        0.525, 0.309, 0.444, 0.347, 0.396, 0.470, 0.332, 0.413, 0.530, 0.370,
        0.530, 0.285, 0.486, 0.260, 0.483, 0.343, 0.457, 0.428, 0.286, 0.591,
        0.470, 0.371, 0.542, 0.213, 0.739)
)

df_ex_8_2 <- data.frame(
  x = c(0.003, 0.043, 0.068, 0.079, 0.079, 0.095, 0.111, 0.118, 0.124, 0.130,
        0.138, 0.149, 0.152, 0.162, 0.173, 0.180, 0.185, 0.189, 0.198, 0.202,
        0.215, 0.219, 0.229, 0.235, 0.239, 0.248, 0.254, 0.264, 0.278, 0.285,
        0.299, 0.308, 0.320, 0.333, 0.347, 0.366, 0.384, 0.395, 0.405, 0.421,
        0.446, 0.464, 0.500, 0.529, 0.578, 0.621, 0.705),
  y = c(0.453, 0.144, 0.047, 0.077, 0.219, 0.183, 0.096, 0.132, 0.180, 0.257,
        0.202, 0.160, 0.241, 0.350, 0.223, 0.393, 0.329, 0.273, 0.441, 0.383,
        0.308, 0.437, 0.378, 0.247, 0.347, 0.482, 0.365, 0.513, 0.436, 0.478,
        0.554, 0.482, 0.581, 0.593, 0.593, 0.699, 0.726, 0.753, 0.812, 0.778,
        0.784, 0.866, 0.867, 0.888, 0.931, 0.945, 0.968)
)

df_ex_8_3 <- data.frame(
  x = c(0.042, 0.102, 0.125, 0.137, 0.159, 0.167, 0.180, 0.192, 0.206, 0.218,
        0.228, 0.233, 0.246, 0.254, 0.261, 0.266, 0.276, 0.282, 0.287, 0.298,
        0.304, 0.311, 0.321, 0.326, 0.330, 0.340, 0.348, 0.355, 0.361, 0.366,
        0.374, 0.384, 0.392, 0.402, 0.409, 0.419, 0.426, 0.434, 0.440, 0.449,
        0.456, 0.463, 0.469, 0.476, 0.485, 0.496, 0.505, 0.514, 0.521, 0.531,
        0.539, 0.547, 0.553, 0.561, 0.571, 0.585, 0.598, 0.613, 0.632),
  y = c(0.135, 0.237, 0.153, 0.296, 0.099, 0.361, 0.202, 0.261, 0.351, 0.237,
        0.131, 0.323, 0.404, 0.159, 0.279, 0.200, 0.446, 0.244, 0.347, 0.175,
        0.387, 0.272, 0.490, 0.319, 0.401, 0.365, 0.276, 0.458, 0.340, 0.431,
        0.208, 0.369, 0.307, 0.423, 0.320, 0.511, 0.380, 0.451, 0.352, 0.492,
        0.300, 0.564, 0.333, 0.464, 0.379, 0.521, 0.413, 0.596, 0.465, 0.553,
        0.428, 0.639, 0.489, 0.557, 0.603, 0.648, 0.677, 0.716, 0.6)
)

df_ex_8_4 <- data.frame(
  x = c(0.044, 0.070, 0.107, 0.114, 0.130, 0.144, 0.151, 0.153, 0.160, 0.171,
        0.179, 0.188, 0.195, 0.205, 0.210, 0.214, 0.221, 0.227, 0.232, 0.239,
        0.245, 0.253, 0.258, 0.262, 0.268, 0.276, 0.281, 0.284, 0.289, 0.296,
        0.302, 0.309, 0.315, 0.322, 0.328, 0.333, 0.339, 0.346, 0.352, 0.357,
        0.364, 0.369, 0.373, 0.378, 0.383, 0.387, 0.393, 0.399, 0.404, 0.410,
        0.417, 0.421, 0.425, 0.429, 0.434, 0.439, 0.445, 0.452, 0.457, 0.464,
        0.470, 0.476, 0.481, 0.487, 0.495, 0.503, 0.512, 0.523, 0.533, 0.549,
        0.562),
  y = c(0.809, 0.565, 0.319, 0.384, 0.850, 0.449, 0.269, 0.705, 0.522, 0.448,
        0.753, 0.603, 0.369, 0.657, 0.512, 0.377, 0.591, 0.423, 0.305, 0.506,
        0.691, 0.549, 0.335, 0.406, 0.240, 0.492, 0.190, 0.625, 0.393, 0.144,
        0.463, 0.301, 0.646, 0.446, 0.357, 0.533, 0.264, 0.576, 0.446, 0.316,
        0.601, 0.394, 0.717, 0.489, 0.285, 0.549, 0.408, 0.215, 0.517, 0.353,
        0.628, 0.413, 0.516, 0.283, 0.565, 0.352, 0.479, 0.186, 0.558, 0.395,
        0.468, 0.267, 0.444, 0.177, 0.489, 0.241, 0.417, 0.129, 0.358, 0.068,
        0.229)
)

ex_8_plt <- function(df) {
  df |> 
  ggplot(aes(x, y)) +
  geom_point(size = 4) +
  theme_bw() + 
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  )
}
```

```{r}
#| echo: false
#| layout-ncol: 4

ex_8_plt(df_ex_8_1)
ex_8_plt(df_ex_8_2)
ex_8_plt(df_ex_8_3)
ex_8_plt(df_ex_8_4)
```

## Answer

[Reading the plots from left to right.]{style="color:red"}

[* The 4th plot shows a negative trend, so its $r$-value must be the only negative value: $r = -0.341$.<br> 
* The 2nd plot shows the strongest positive association, so its $r$-value must be the closest to $+1$: $r = 0.885$.<br> 
* The 3rd plot also shows a positive trend, but its strength of association is not as strong as the 2nd plot, so $r = 0.724.$.<br> 
* This means the 1st plot must have $r = 0.119$. This choice is justified, since the plot shows very little positive trend and nearly no association.]{style="color:red"}
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 9.

::: panel-tabset
## Question

Suppose a new data set has been added to the table in Example 7 with the new scatterplot shown below.

a.  Describe and interpret the association.
b.  What do you think happened with the one point that does not follow the trend? Does this value seem accurate?
c.  If the potential outlier in the graph is corrected or removed, what do you think will happen to the $r$-value?

```{r}
#| include: false

df_ex_9 <- data.frame(
  x = c(200, 150, 110, 60, 350, 225, 400, 300, 800),
  y = c(11.1, 5.37, 4.4, 1.71, 11.67, 7.76, 12.5, 9.09, 3)
)
```

```{r}
#| echo: false

ex_9_plt <- df_ex_9 |> 
  ggplot(aes(x, y)) +
  geom_point() +
  theme_bw() +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) +
  labs(
    x = "Miles Traveled",
    y = 'Fuel Consumption'
  )

ex_9_plt 
```

## Answer

[a. There seems to be a strong linear association between the miles traveled and fuel consumption. There is, however, an unusual data point that does not follow the trend.<br> b. It could be a typographical error, or it could be an electric/hybrid vehicle. The scatterplot is reasonable if the vehicle is an electric or hybrid.<br> c. If the outlier is removed, then the $r$-value will increase.]{style="color:red"}
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 10.

::: panel-tabset
## Question

Both scatterplots below assess average miles per gallon fuel consumption for passenger cars. Both depict data from the sample of vehicles.

a.  What is the approximate average mpg for a car with a cab space of 120 cubic feet?
b.  What is the approximate average mpg for a car with a horsepower of 150?
c.  Are these associations positive, negative, or there is no trend?
d.  Which do you think has a stronger relationship with average mileage--the car’s horsepower or the cab space? Why?
e.  If you wanted to predict the average mileage for a car, would you be able to make a better prediction by knowing its horsepower or its cab space in cubic feet?

```{r}
#| include: false

df_ex_10_a <- data.frame(
  horsepower = c(55.6, 69.7, 86.7, 87.8, 93.8, 93.9, 100.7, 100.7, 109.1, 111.3, 117.9, 118.0, 120.1, 124.7, 124.9, 128.4, 139.1, 139.2, 143.3, 152.0, 160.3, 164.7, 169.0, 177.3, 180.4, 190.3, 194.5, 238.0, 242.1, 250.0, 265.4, 280.0, 292.6, 315.7),
  mpg = c(35.8, 47.1, 42.8, 53.6, 50.6, 57.1, 42.7, 45.8, 39.7, 31.1, 24.4, 30.5, 35.8, 22.7, 27.1, 31.4, 22.7, 27.7, 20.0, 22.7, 18.2, 22.5, 17.8, 23.4, 17.6, 13.4, 25.3, 11.6, 6.4, 17.6, 10.5, 17.6, 10.2, 11.8)
)

df_ex_10_b <- data.frame(
  cab_space = c(55.2, 56.5, 57.2, 66.3, 66.3, 66.3, 66.3, 66.3, 66.3, 68.3, 97.3, 99.1, 99.1, 99.9, 100.0, 101.6, 102.4, 102.4, 102.5, 102.5, 102.5, 104.2, 104.2, 105.9, 107.2, 108.4, 108.4, 108.5, 110.3, 110.6, 112.0, 112.8, 115.3, 115.4, 115.4, 118.9, 119.8, 121.0, 121.4, 122.3, 122.3, 123.2, 124.0, 125.8, 127.4, 129.2, 130.0, 130.1, 132.6, 134.3, 134.4, 136.1, 136.9, 139.6, 140.0, 141.7, 146.8, 152.0, 153.8),
  mpg = c(36.3, 36.7, 35.0, 57.5, 34.7, 11.6, 51.1, 18.0, 37.6, 38.0, 27.7, 30.9, 27.6, 43.2, 36.2, 34.7, 42.9, 23.2, 54.0, 46.2, 27.8, 40.0, 23.1, 35.5, 31.1, 26.9, 34.5, 37.3, 36.3, 23.8, 38.7, 43.9, 37.1, 32.3, 6.7, 22.8, 18.1, 31.6, 18.2, 23.2, 11.1, 20.4, 34.6, 10.6, 18.2, 18.4, 23.2, 26.7, 18.2, 13.8, 17.5, 20.0, 17.6, 18.0, 22.7, 22.4, 21.3, 20.2, 19.8)
)
```

```{r}
#| echo: false
#| message: false

ex_10_a_plt <- df_ex_10_a |> 
  ggplot(aes(horsepower, mpg)) +
  geom_point() +
  geom_smooth(
    method = 'lm',
    color = 'red',
    linewidth = 1.25,
    se = FALSE
  ) +
  theme_bw() +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) +
  labs(
    x = "Horsepower",
    y = 'Average Mileage'
  )

ex_10_b_plt <- df_ex_10_b |> 
  ggplot(aes(cab_space, mpg)) +
  geom_point() +
  geom_smooth(
    method = 'lm',
    color = 'blue',
    linewidth = 1.25,
    se = FALSE
  ) +
  theme_bw() +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) +
  labs(
    x = "Cab Space",
    y = 'Average Mileage'
  )

ex_10_a_plt  

ex_10_b_plt  
```

## Answer

[a. Using the blue regression line as a guide, a car with 120 cubic feet of cab space has an average mileage of roughly 26 mpg.<br> b. Using the red regression line as a guide, a car with a 150 horsepower has an average mileage of roughly 28 mpg.<br> c. Both lines have negative slopes, so both associations are negative.<br> d. The red line has a steeper slope, indicating that the association between horsepower and average mileage is stronger.<br> e. Because the relationship between horsepower and average mileage is stronger, one can make better predictions of a car's average mileage by knowing its horsepower rather than its cab space.]{style="color:red"}
:::
::::

## Section 4.3. Modeling Linear Trends

::: {.callout-note appearance="default" icon="false"}
## Regression Line

-   A tool for making predictions about [**future observed value**]{style="color:red"}.
-   Has the form [$y = b + mx$]{style="color:red"}, where $b$ is the $y$-value for the $y$-intercept and $m$ is the slope.
-   Usually generated using technology.
:::

:::: {.callout-tip appearance="default" icon="false"}
::: panel-tabset
## Example 4.4.1.

The scatterplot below shows the average number of years in school compared to hourly wages from census data taken in 1970.

a.  Describe the trend of the scatterplot.
b.  Suppose that $r = 0.883$. What does the positive trend tell you about the relationship between the number of years in school and the hourly wage?

```{r}
#| echo: false
#| message: false

df_ex_4_4_1 <- df <- data.frame(
  years_in_school = c(
    6.73, 8.02, 8.02, 8.33, 8.37, 8.66, 8.70, 8.78, 9.07, 9.12, 9.46, 9.49, 9.51, 9.54, 9.56, 9.92, 10.04, 10.16, 10.43, 10.54, 10.66, 10.83, 11.24, 11.25, 11.33, 11.35
  ),
  wage = c(
    1.55, 2.83, 2.61, 2.14, 2.78, 2.71, 2.65, 3.07, 3.34, 3.34, 2.98, 3.15, 3.35, 3.56, 3.14, 3.40, 3.19, 3.22, 3.96, 4.18, 3.81, 4.22, 4.23, 3.93, 4.27, 4.64
  )
)

ex_4_4_1_plt <- df_ex_4_4_1 |> 
  ggplot(aes(years_in_school, wage)) +
  geom_point() +
  geom_smooth(
    method = 'lm',
    linewidth = 1.25,
    color = 'blue',
    alpha = 0.75,
    se = FALSE
  ) + 
  theme_bw() +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) +
  labs(
    x = 'Years in School',
    y = 'Hourly Wage'
  )

ex_4_4_1_plt  
```

## Answer

[a. The scatterplot has a strong, positive, linear trend.<br> b. The positive $r$-value (correlation coefficient) indicates that people who spent more years in school *tend to* have higher hourly wages.]{style="color:red"}
:::
::::

::: {.callout-important appearance="default"}
## Remark

-   Changing the order of the $x$- and the $y$-variables will change the regression equation. (The correlation coefficient, $r$, will remain the same, however.)
-   There are several synonymous terms for the $x$- and $y$-variables.

|                                      |                                    |
|------------------------------------|------------------------------------|
| **x-variable**                       | **y-variable**                     |
| [**Explanatory**]{style="color:red"} | [**Response**]{style="color:red"}  |
| [**Predictor**]{style="color:red"}   | [**Predicted**]{style="color:red"} |
| [**Independent**]{style="color:red"} | [**Dependent**]{style="color:red"} |
:::

::: {.callout-note appearance="default" icon="false"}
## Interpreting the Slope of the Regression Equation

-   Slope of the regression line tells us how much the [$y$]{style="color:red"}-variable changes when the [$x$]{style="color:red"}-variable is increased by [**one**]{style="color:red"} unit.
-   A regression line with slope close to [**zero**]{style="color:red"} means there is no linear relationship between the $x$- and the $y$-variable.
:::

:::: {.callout-tip appearance="default" icon="false"}
## Example 4.4.2.

::: panel-tabset
## Question

Suppose that the association between a car's mileage and its sales price was modeled by a regression with the following regression equation: $$
  \text{Price} = 15867 - 0.034 \, \text{Miles}
$$ Interpret the slope of the regression line.

## Answer

[For every additional 1 mile driven, the value of the car *decreases* by \$0.034.]{style="color:red"}
:::
::::

::: {.callout-note appearance="default" icon="false"}
## Interpreting the $y$-Intercept of the Regression Line

-   The $y$-intercept is the [**predicted value ($y$-variable) when the predictor ($x$-variable) is 0.**]{style="color:red"}
-   The $y$-intercept is meaningful only if it makes sense for $x$ to [**equal zero**]{style="color:red"}.
:::

:::: {.callout-tip appearance="default" icon="false"}
## Example 4.4.3.

::: panel-tabset
## Question

Interpret the $y$-intercept of the regression equation from Example 4.4.2:

$$
  \text{Price} = 15867 - 0.034 \, \text{Miles}
$$

## Answer

[**If the car were brand new, its value would be \$15,867.**]{style="color:red"}
:::
::::

## Section 4.4. Evaluating the Linear Model

::: {.callout-caution appearance="default"}
## Cautionary Notes Regarding Linear Regression

-   Do *not* use [**linear**]{style="color:red"} to describe nonlinear associations.
-   [**Correlation is *not* causation**]{style="color:red"}: Association between two variables is not sufficient evidence to conclude that a cause-and-effect relationship exists between the variables.
-   [**Beware of outliers**]{style="color:red"}: Outliers can have a big effect on $r$. Always check the scatterplot for outliers first.
-   [**Do no extrapolate**]{style="color:red"}: Do not make predictions beyond the range of the observed data. We can never be certain a linear trend will continue beyond the range of the data.
:::

::: {.callout-note appearance="default" icon="false"}
## Coefficient of Determination

-   The coefficient of determination is $r^2$, where $r$ is the correlation coefficient.
-   The $r^2$-value is usually converted to a percentage, so it is always between 0% and 100%.
-   It measures how much [**variation**]{style="color:red"} in the [**response**]{style="color:red"} variable ($y$) is explained by the [**explanatory**]{style="color:red"} variable ($x$).
-   The larger $r^2$ is, the smaller the amount of variation or scatter about the regression line there is.
:::

## Section 4.3, 4.4 Examples

:::: {.callout-tip appearance="default" icon="false"}
## Example 1.

::: panel-tabset
## Question

Below is a scatterplot showing the relationship between mileage (in thousands of miles) and the price of used cars (in thousands of dollars).

a.  The scatterplot shows a \_\_\_\_\_\_\_ trend. As the mileage on a car increases, its sales price \_\_\_\_\_\_\_.
b.  Suppose the equation of the regression line is $$
      \text{Price} = 15,867 - 34 \text{Miles}
    $$ Use the regression equation to predict the sales price of a car that has 62,000 miles.

```{r}
#| echo: false
#| message: false

df_43_44_ex_1 <- tibble(
  miles = c(11, 11.4, 15.7, 16.3, 21, 19, 17, 18.3, 22, 23.8, 27.4, 25, 30.4, 30.6, 36.2, 42, 42, 34, 33, 35.7, 38, 65.7),
  price = c(18.7, 16, 17, 19, 19, 18, 17, 15, 16, 16.8, 17.5, 15.6, 15.2, 14, 13.3, 13.2, 14, 15.1, 15.8, 17.7, 16, 13)
)

plt_43_44_ex_1 <- df_43_44_ex_1 |> 
  ggplot(aes(miles, price)) +
  geom_point() +
  geom_smooth(
    method = 'lm',
    linewidth = 1.25,
    color = 'red',
    se = FALSE
  ) +
  theme_bw() +
  labs(
    x = "Miles",
    y = 'Price'
  ) + 
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) 

plt_43_44_ex_1  
```

## Answer

a.  The scatterplot shows a [**negative**]{style="color:red"} trend. As the mileage on a car increases, its sales price [**decrease**]{style="color:red"}.
b.  First convert 62,000 miles into $62000/1000 = 62$ since the $x$-axis is measured in thousands of miles. Then substitute this into the "Miles" variable of the regression equation: $$
      \text{Price} = 15867 - 34 \times 62 = \$13,769.
    $$
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 2.

::: panel-tabset
## Question

It was found that there was a strong relationship between the heights and weights in a group of six women. The regression equation was given as $$
  \text{Weight} = -442.882 + 9.029 \text{ Height}.
$$ Interpret the $y$-intercept, if appropriate.

## Answer

The $y$-intercept in this instance is $-442.882$. This implies that a woman would weigh $-442.882$ lb if her height were 0 in, which is not physically meaningful.
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 3.

::: panel-tabset
## Question

The scatterplot and regression line show the relationship between population size and number of fatal car accidents for all 50 states. Use the data provided to answer the questions below.

a. Identify the dependent and independent variables.
b. Is this a positive or negative correlation?
c. Describe the association between the variables.
d. Interpret the slop and the $y$-intercept, if appropriate.

|                          |               |
|--------------------------|---------------|
| Dependent Variable:      | Fatal Crashes |
| Independent Variable:    | Population    |
| Regression Equation:     | $\text{Fatal Crashes} = 77.073 + 0.0000826 \text{ Population}$              |
| Sample Size:             | 51            |
| Correlation Coefficient ($r$): | 0.93228819    |
| R-Square                 | 0.86916127    |

: Simple Linear Regression Results

```{r}
#| echo: false
#| message: false

df_43_44_ex_3 <- tibble(
  pop = c(27906939, 39388996, 20649636, 19867826, 10395318, 10173614, 
12760465, 12825807, 11716829, 9906286, 6666246, 4925172, 6125170, 
6964985, 6610075, 8402506, 8963529, 7289860, 5543742, 5826202, 
6105682, 6847599, 5475419, 4558570, 4665180, 3923951, 3036907, 
2980736, 4121582, 2980965, 3181117, 2915394, 3053185, 3544968, 
2028349, 1731903, 1852729, 984943, 1342374, 1296520, 838439, 
525945, 608023, 608023, 959952),
  crashes = c(3411, 3360, 2935, 960, 1418, 1345, 1087, 988, 1058, 981, 965, 
934, 870, 870, 757, 724, 572, 493, 568, 526, 464, 345, 349, 766, 
698, 614, 633, 481, 448, 373, 343, 310, 262, 266, 354, 244, 202, 
170, 147, 106, 114, 97, 24, 24, 35)
)

plt_43_44_ex_3 <- df_43_44_ex_3 |> 
  ggplot(aes(pop, crashes)) +
  geom_point(
    alpha = 0.75
  ) +
  geom_line(
    stat = "smooth",
    method = 'lm',
    linewidth = 1.25,
    color = 'red',
    se = FALSE,
    alpha = 0.5
  ) +
  scale_x_continuous(
    labels = unit_format(
      unit = 'million',
      scale = 1e-6
    )
  ) +
  theme_bw() +
  labs(
    x = "Population",
    y = 'Number of Fatal Crashes'
  ) + 
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) 

plt_43_44_ex_3  
```

## Answer

[a. The dependent ($x$-) variable is **population**; the independent ($y$-) variable is **number of fatal crashes**.
 b. The regression equation has a _positive slope_ of $m = 0.0000826$, so the association is positive.
 c. As the population increases, the number of fatal crashes tends to increase.
 d. - **Slope:** For every additional 1 person in the population, the number of fatal crashes increases by 0.0000826.
    - **$y$-intercept:** The $y$-intercept is 77.073. This means that if a state had a population of zero, there would be 77.073 fatal crashes, which is not physically possible.
]{style='color:red'}
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 5.

::: panel-tabset
## Question

Suppose there is a strong linear relationship between women's heights and their weights, with a regression equation given below:
$$
  \text{Weight} = -442.882 + 9.029 \text{ Height}
$$
What weight does this equation predict for a woman who is 36 inches tall?

## Answer

[Substitute 36 into **Height** in the equation:
$$
  \text{Weight} = -442.882 + 9.029 \times 36 = -117.838 \text{ lb}
$$
This is not possible because a person cannot have a negative weight.
]{style='color:red'}
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Example 6.

::: panel-tabset
## Question

Suppose the data on a car’s age and its predicted monetary value produces a correlation coefficient of $r = −0.778$. Compute and interpret the coefficient of determination.

## Answer

Recall that the **coefficient of determination** is defined as $r^2$, where $r$ is the correlation coefficient. Therefore,
$$
  r^2 = (-0.778)^2 = 0.605284 \approx 60.53\%
$$
This means that approximately 60.53\% of the variation in the dependent variable can be explained by the independent variable.
:::
::::

## Chapter 4 Quick Review


:::: {.callout-tip appearance="default" icon="false"}
## Question 1.

::: panel-tabset
## Question

The scatterplot below shows what type of relationship between the number of runs scored and the number of hits for a group of baseball players?

```{r}
#| echo: false
#| message: false

df_ch4_q1 <- tibble(
  runs_scored = c(513, 555, 570, 570, 588, 593, 611, 610, 612, 616, 620, 626, 
623, 638, 645, 641, 637, 637, 645, 655, 655, 654, 644, 643, 640, 
654, 657, 657, 663, 668, 668, 681, 673, 666, 707, 713, 731, 744, 
755, 802, 872, 859, 868, 796, 855, 875, 883, 915, 677, 730, 672, 
686, 684, 697, 709, 718, 741, 751, 762, 772, 780, 781, 787, 787, 
817, 818, 791, 798, 803, 820, 804, 785, 784, 773, 768, 773, 759, 
752, 752, 749, 735, 735, 743, 736, 729, 735, 738, 721, 709, 714, 
706, 705, 719, 723),
  hits = c(1275, 1262, 1326, 1326, 1301, 1281, 1349, 1323, 1439, 1443, 
1358, 1358, 1319, 1315, 1329, 1345, 1364, 1364, 1361, 1354, 1360, 
1387, 1396, 1415, 1431, 1424, 1410, 1410, 1394, 1392, 1368, 1363, 
1349, 1337, 1322, 1365, 1357, 1382, 1364, 1343, 1494, 1483, 1451, 
1497, 1599, 1598, 1605, 1605, 1536, 1558, 1471, 1431, 1412, 1410, 
1434, 1476, 1507, 1515, 1513, 1492, 1509, 1521, 1555, 1539, 1539, 
1509, 1515, 1515, 1432, 1439, 1407, 1435, 1447, 1467, 1452, 1450, 
1464, 1467, 1467, 1473, 1462, 1453, 1443, 1439, 1435, 1428, 1412, 
1422, 1415, 1410, 1398, 1379, 1404, 1411)
)

plt_ch4_q1 <- df_ch4_q1 |> 
  ggplot(aes(runs_scored, hits)) +
  geom_point(
    alpha = 0.75
  ) +
  theme_bw() +
  labs(
    x = "Run Scored",
    y = 'Hits'
  ) + 
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank()
  ) 

plt_ch4_q1  
```

## Answer

[There is a moderately strong, positive linear relation between the number of runs scored and the number of hits.]{style='color:red'}

:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Question 2.

::: panel-tabset
## Question

There is a negative association between the percentage of smoke-free homes and the percentage of high school students who smoke. This means what exactly?

## Answer

[This means that as the percentage of smoke-free homes increases, the percentage of high schoolers who smoke tends to decrease.]{style='color:red'}

:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Question 3.

::: panel-tabset
## Question

For a certain group of cars, there is a strong association between the city and the highway mileage that can be described by the following regression equation:
$$
  \text{Predict Hwy MPG} = 8.25 + 0.87 \text{ City MPG}
$$
Interpret the slope.

## Answer

[The slope in this instance is $m = 0.87$. This meant that for every additional one mile per gallon in city mileage, the predicted highway mileage increases by 0.87.]{style='color:red'}

:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Question 4.

::: panel-tabset
## Question

Which of the following values of correlation coefficient indicates the strongest association between two variables? Why? 
$$
  0.32, \; 0.62, \; 0.78, \; -0.98
$$

## Answer

[The correlation coefficient $r$ indicates the strength of the association between two variables; the closer $r$ is to either $+1$ or $-1$, the stronger the relationship. In this case, $r = -0.98$.]{style='color:red'}
:::
::::

:::: {.callout-tip appearance="default" icon="false"}
## Question 5.

::: panel-tabset
## Question

When doing a regression analysis on a data set, which of the following remain the same no matter which variable is chosen for $x$ and which is chosen for $y$?

a. The $x$-intercept of the regression equation
b. The slope of the regression equation
c. The correlation coefficient
b. All of the above

## Answer

[The correct answer is c. The only value in linear regression that is invariant to the order of the variables is the correlation coefficient ($r$).]{style='color:red'}

:::
::::